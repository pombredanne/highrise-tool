#!/usr/bin/env coffee

fs = require 'fs'
{exec} = require 'child_process'

if process.argv.length < 3
  console.warn "Usage: #{process.argv[1]} <username> <password> <domain>"
  process.exit 1

[ username, password, domain ] = process.argv[2..4]

settings_path = "#{process.env.HOME}/scraperwiki.json"
settings = JSON.parse fs.readFileSync(settings_path)

settings.database = 'highrise/scraperwiki.sqlite'
settings.highrise = {}
settings.highrise.username = username
settings.highrise.password = password
settings.highrise.domain = domain

fs.writeFileSync settings_path, JSON.stringify(settings, null, 2)

scraper = exec './scraper.py', (err, stdout, stderr) ->
  console.warn err if err?
  process.stdout.write stdout if stdout?
  process.stderr.write stderr if stderr?
